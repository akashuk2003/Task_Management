{% extends 'base.html' %}

{% block content %}
<h1>SuperAdmin Dashboard</h1>

<div class="card mb-4">
    <div class="card-header">Create New Task</div>
    <div class="card-body">
        <form method="post">
            {% csrf_token %}
            {{ form.as_p }}
            <button type="submit" class="btn btn-primary">Create Task</button>
        </form>
    </div>
</div>
<div class="card mt-4">
    <div class="card-header d-flex justify-content-between align-items-center">
        <span>All Users</span>
        <a href="{% url 'user-create' %}" class="btn btn-success btn-sm">Create New User</a>
    </div>
    <div class="table-responsive">
        <table class="table table-striped mb-0">
            <thead>
                <tr>
                    <th>Username</th>
                    <th>Email</th>
                    <th>Admin Status</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for u in all_users %}
                <tr>
                    <td>{{ u.username }}</td>
                    <td>{{ u.email }}</td>
                    <td>{% if u.groups.all.0.name == "Admin" %}Admin{% else %}User{% endif %}</td>
                    <td>
                        <a href="{% url 'user-update' u.id %}" class="btn btn-primary btn-sm">Edit</a>
                        {% if not u.is_superuser %}
                        <a href="{% url 'user-delete' u.id %}" class="btn btn-danger btn-sm">Delete</a>
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>


<div class="card mt-4">
    <div class="card-header">All Tasks</div>
    <ul class="list-group list-group-flush">
        {% for task in all_tasks %}
            <li class="list-group-item">{{ task.title }} ({{ task.status }}) - Assigned to: {{ task.assigned_to.username }}</li>
        {% endfor %}
    </ul>
</div>

<table class="table table-striped mb-0">
    <thead>
        <tr>
            <th>Title</th>
            <th>Assigned To</th>
            <th>Status</th>
            <th>Worked Hours</th>
            <th>Report</th>
        </tr>
    </thead>
    <tbody>
        {% for task in all_tasks %}
        <tr>
            <td>{{ task.title }}</td>
            <td>{{ task.assigned_to.username }}</td>
            <td>{{ task.status }}</td>
            <td>{{ task.worked_hours|default:"--" }}</td>
            <td>
                {% if task.status == 'Completed' %}
                    <a href="{% url 'task-report-detail' task.id %}" class="btn btn-info btn-sm">View Report</a>
                {% else %}
                    <span>--</span>
                {% endif %}
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<tbody>
    {% for u in all_users %}
    <tr>
        <td>{{ u.username }}</td>
        <td>{{ u.email }}</td>
        <td>
            {% if u.is_admin %}
                <span class="badge bg-success">Admin</span>
            {% else %}
                <span class="badge bg-secondary">User</span>
            {% endif %}
        </td>
        <td>
            <div class="d-flex">
                <a href="{% url 'user-update' u.id %}" class="btn btn-primary btn-sm me-1">Edit</a>
                
                {% if not u.is_superuser %}
                    <form action="{% url 'user-toggle-admin' u.id %}" method="post" class="me-1">
                        {% csrf_token %}
                        {% if u.is_admin %}
                            <button type="submit" class="btn btn-warning btn-sm">Demote</button>
                        {% else %}
                            <button type="submit" class="btn btn-info btn-sm">Promote</button>
                        {% endif %}
                    </form>

                    <a href="{% url 'user-delete' u.id %}" class="btn btn-danger btn-sm">Delete</a>
                {% endif %}
            </div>
        </td>
    </tr>
    {% endfor %}
</tbody>



{% endblock %}